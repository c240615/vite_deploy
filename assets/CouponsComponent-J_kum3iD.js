import{a as h}from"./axios-5KWFXKlW.js";import{_ as M,o as l,c as a,b as e,d as _,v as b,l as T,m as $,w as k,F as C,j as x,g as c,r as u,t as f}from"./index-ruAEl9v8.js";import{M as V,T as D,u as N}from"./ToastComponent-De44Fyty.js";import{P as E,D as P}from"./DeleteModal-mjufGd9f.js";const U={props:["tempItem","isNew","getCoupons","updateCoupon"],data(){return{modalCoupon:null,editCoupon:{}}},methods:{openModal(){this.modalCoupon.show()},closeModal(){this.modalCoupon.hide()}},watch:{tempItem(o,t){this.editCoupon=this.tempItem}},mounted(){this.modalCoupon=new V(this.$refs.couponModal),this.editCoupon=this.tempItem,this.editCoupon.is_enabled=0}},L={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-sm"},R={class:"modal-content border-0"},S={class:"modal-header bg-dark text-white"},A={id:"couponModalLabel",class:"modal-title"},H={key:0},q={key:1},F=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},j={class:"mb-3"},G=e("label",{for:"title",class:"form-label"},"名稱",-1),z={class:"mb-4"},J=e("label",{for:"origin_price",class:"form-label"},"折扣",-1),K={class:"mb-3"},Q={class:"form-check"},W=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),X={class:"modal-footer"},Y=e("button",{type:"button",class:"btn btn-outline-success","data-bs-dismiss":"modal"}," 取消 ",-1);function Z(o,t,d,g,s,i){return l(),a("div",L,[e("div",B,[e("div",R,[e("div",S,[e("h5",A,[d.isNew?(l(),a("span",H,"新增優惠券")):(l(),a("span",q,"編輯優惠券"))]),F]),e("div",O,[e("div",j,[G,_(e("input",{id:"title","onUpdate:modelValue":t[0]||(t[0]=n=>s.editCoupon.title=n),type:"text",class:"form-control",placeholder:"請輸入標題",required:""},null,512),[[b,s.editCoupon.title]])]),e("div",z,[J,_(e("input",{id:"origin_price","onUpdate:modelValue":t[1]||(t[1]=n=>s.editCoupon.percent=n),type:"number",min:"0",max:"1",step:"0.1",class:"form-control",placeholder:"請輸入折扣 (0 - 1)",required:""},null,512),[[b,s.editCoupon.percent,void 0,{number:!0}]])]),e("div",K,[e("div",Q,[_(e("input",{id:"is_enabled","onUpdate:modelValue":t[2]||(t[2]=n=>s.editCoupon.is_enabled=n),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[T,s.editCoupon.is_enabled]]),W])])]),e("div",X,[Y,e("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=(...n)=>d.updateCoupon&&d.updateCoupon(...n))}," 確認 ")])])])],512)}const ee=M(U,[["render",Z]]);var te={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"claire_vue3_apipath",VITE_GITHUB:"https://github.com/c240615/vite_deploy",BASE_URL:"/vite_deploy/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:m,VITE_PATH:r}=te,oe={data(){return{coupons:[],pages:{},item:"coupon",isNew:!1,tempItem:{}}},methods:{...$(N,["showToast"]),getCoupons(){const o=`${m}/api/${r}/admin/coupons`;h.get(o).then(t=>{this.coupons=t.data.coupons,this.pages=t.data.pagination}).catch(t=>{this.showToast("編輯失敗",`${t.message}`)})},updateCoupon(){let o=`${m}/api/${r}/admin/coupon`,t="post";this.isNew||(o=`${m}/api/${r}/admin/coupon/${this.tempItem.id}`,t="put"),h[t](o,{data:{title:this.tempItem.title,is_enabled:this.tempItem.is_enabled,percent:this.tempItem.percent,due_date:new Date().getTime(),code:"testCode"}}).then(d=>{this.getCoupons(),this.$refs.cModal.closeModal(),this.tempItem={},this.showToast(`${d.data.message}`,"success")}).catch(d=>{this.$refs.cModal.closeModal(),this.showToast("編輯失敗","error")})},deleteCoupon(){const o=`${m}/api/${r}/admin/coupon/${this.tempItem.id}`;h.delete(o).then(t=>{this.getCoupons(),this.tempItem={},this.$refs.dModal.closeModal(),this.showToast(`${t.data.message}`,"success")}).catch(t=>{this.$refs.dModal.closeModal(),this.showToast("刪除失敗","error")})},openModal(o,t){o==="new"?(this.tempItem={},this.isNew=!0,this.$refs.cModal.openModal()):o==="edit"?(this.tempItem={...t},this.isNew=!1,this.$refs.cModal.openModal()):o==="delete"&&(this.tempItem={...t},this.isNew=!1,this.$refs.dModal.openModal())}},mounted(){this.getCoupons()},components:{PaginationComponent:E,CouponModal:ee,DeleteModal:P,ToastComponent:D}},se={class:"container"},ne={class:"text-end mt-4"},ie={class:"table mt-4 text-start"},le=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",{width:"120"},"折扣"),e("th",{width:"120"},"啟用"),e("th",{width:"120"},"修改資料")])],-1),ae={key:0,class:"text-primary"},de={key:1},pe={class:"btn-group"},ce=["onClick"],ue=["onClick"];function me(o,t,d,g,s,i){const n=u("PaginationComponent"),v=u("CouponModal"),w=u("DeleteModal"),I=u("ToastComponent");return l(),a(C,null,[e("div",se,[e("div",ne,[e("button",{class:"btn btn-orange",onClick:t[0]||(t[0]=k(p=>i.openModal("new"),["prevent"]))}," 新增優惠券 ")]),e("table",ie,[le,e("tbody",null,[(l(!0),a(C,null,x(s.coupons,p=>(l(),a("tr",{key:p.title},[e("td",null,f(p.title),1),e("td",null,f(p.percent),1),p.is_enabled?(l(),a("td",ae,"啟用")):(l(),a("td",de,"未啟用")),e("td",null,[e("div",pe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y=>i.openModal("edit",p)}," 編輯 ",8,ce),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:y=>i.openModal("delete",p)}," 刪除 ",8,ue)])])]))),128))])]),c(n,{pages:s.pages,item:s.item,"get-coupons":i.getCoupons},null,8,["pages","item","get-coupons"])]),c(v,{"temp-item":s.tempItem,"is-new":s.isNew,"get-coupons":i.getCoupons,"update-coupon":i.updateCoupon,ref:"cModal"},null,8,["temp-item","is-new","get-coupons","update-coupon"]),c(w,{"temp-item":s.tempItem,"delete-product":o.deleteProduct,"delete-coupon":i.deleteCoupon,ref:"dModal"},null,8,["temp-item","delete-product","delete-coupon"]),c(I)],64)}const Ce=M(oe,[["render",me]]);export{Ce as default};
